
const AREA_CODE_TO_TIMEZONE = {
  '201': 'ET', '202': 'ET', '203': 'ET', '205': 'ET', '206': 'ET', '207': 'ET',
  '212': 'ET', '213': 'ET', '214': 'ET', '215': 'ET', '216': 'ET', '217': 'ET',
  '218': 'ET', '219': 'ET', '224': 'ET', '225': 'ET', '228': 'ET', '229': 'ET',
  '231': 'ET', '234': 'ET', '239': 'ET', '240': 'ET', '248': 'ET', '251': 'ET',
  '252': 'ET', '253': 'ET', '254': 'ET', '256': 'ET', '260': 'ET', '262': 'ET',
  '267': 'ET', '269': 'ET', '270': 'ET', '272': 'ET', '274': 'ET', '276': 'ET',
  '281': 'ET', '283': 'ET', '301': 'ET', '302': 'ET', '303': 'ET', '304': 'ET',
  '305': 'ET', '307': 'ET', '308': 'ET', '309': 'ET', '310': 'ET', '312': 'ET',
  '313': 'ET', '314': 'ET', '315': 'ET', '316': 'ET', '317': 'ET', '318': 'ET',
  '319': 'ET', '320': 'ET', '321': 'ET', '323': 'ET', '325': 'ET', '326': 'ET',
  '330': 'ET', '331': 'ET', '332': 'ET', '334': 'ET', '336': 'ET', '337': 'ET',
  '339': 'ET', '340': 'ET', '341': 'ET', '346': 'ET', '347': 'ET', '351': 'ET',
  '352': 'ET', '360': 'ET', '361': 'ET', '364': 'ET', '380': 'ET', '385': 'ET',
  '386': 'ET', '401': 'ET', '402': 'ET', '404': 'ET', '405': 'ET', '406': 'ET',
  '407': 'ET', '408': 'ET', '409': 'ET', '410': 'ET', '412': 'ET', '413': 'ET',
  '414': 'ET', '415': 'ET', '417': 'ET', '419': 'ET', '423': 'ET', '424': 'ET',
  '425': 'ET', '430': 'ET', '432': 'ET', '434': 'ET', '435': 'ET', '440': 'ET',
  '442': 'ET', '443': 'ET', '445': 'ET', '447': 'ET', '448': 'ET', '458': 'ET',
  '463': 'ET', '464': 'ET', '469': 'ET', '470': 'ET', '475': 'ET', '478': 'ET',
  '479': 'ET', '480': 'ET', '484': 'ET', '501': 'ET', '502': 'ET', '503': 'ET',
  '504': 'ET', '505': 'ET', '507': 'ET', '508': 'ET', '509': 'ET', '510': 'ET',
  '512': 'ET', '513': 'ET', '515': 'ET', '516': 'ET', '517': 'ET', '518': 'ET',
  '520': 'ET', '530': 'ET', '531': 'ET', '534': 'ET', '539': 'ET', '540': 'ET',
  '541': 'ET', '551': 'ET', '557': 'ET', '559': 'ET', '561': 'ET', '562': 'ET',
  '563': 'ET', '564': 'ET', '567': 'ET', '570': 'ET', '571': 'ET', '572': 'ET',
  '573': 'ET', '574': 'ET', '575': 'ET', '580': 'ET', '585': 'ET', '586': 'ET',
  '601': 'ET', '602': 'ET', '603': 'ET', '605': 'ET', '606': 'ET', '607': 'ET',
  '608': 'ET', '609': 'ET', '610': 'ET', '612': 'ET', '613': 'ET', '614': 'ET',
  '615': 'ET', '616': 'ET', '617': 'ET', '618': 'ET', '619': 'ET', '620': 'ET',
  '623': 'ET', '624': 'ET', '625': 'ET', '626': 'ET', '627': 'ET', '628': 'ET',
  '629': 'ET', '630': 'ET', '631': 'ET', '636': 'ET', '640': 'ET', '641': 'ET',
  '646': 'ET', '647': 'ET', '649': 'ET', '650': 'ET', '651': 'ET', '657': 'ET',
  '659': 'ET', '660': 'ET', '661': 'ET', '662': 'ET', '667': 'ET', '669': 'ET',
  '670': 'ET', '671': 'ET', '672': 'ET', '678': 'ET', '679': 'ET', '680': 'ET',
  '681': 'ET', '682': 'ET', '684': 'ET', '689': 'ET', '701': 'ET', '702': 'ET',
  '703': 'ET', '704': 'ET', '706': 'ET', '707': 'ET', '708': 'ET', '712': 'ET',
  '713': 'ET', '714': 'ET', '715': 'ET', '716': 'ET', '717': 'ET', '718': 'ET',
  '719': 'ET', '720': 'ET', '721': 'ET', '724': 'ET', '725': 'ET', '726': 'ET',
  '727': 'ET', '728': 'ET', '729': 'ET', '730': 'ET', '731': 'ET', '732': 'ET',
  '734': 'ET', '737': 'ET', '740': 'ET', '743': 'ET', '747': 'ET', '754': 'ET',
  '757': 'ET', '758': 'ET', '760': 'ET', '762': 'ET', '763': 'ET', '764': 'ET',
  '765': 'ET', '769': 'ET', '770': 'ET', '771': 'ET', '772': 'ET', '773': 'ET',
  '774': 'ET', '775': 'ET', '779': 'ET', '781': 'ET', '784': 'ET', '785': 'ET',
  '786': 'ET', '787': 'ET', '801': 'ET', '802': 'ET', '803': 'ET', '804': 'ET',
  '805': 'ET', '806': 'ET', '807': 'ET', '808': 'ET', '810': 'ET', '812': 'ET',
  '813': 'ET', '814': 'ET', '815': 'ET', '816': 'ET', '817': 'ET', '818': 'ET',
  '819': 'ET', '820': 'ET', '825': 'ET', '828': 'ET', '829': 'ET', '830': 'ET',
  '831': 'ET', '832': 'ET', '843': 'ET', '845': 'ET', '847': 'ET', '848': 'ET',
  '850': 'ET', '851': 'ET', '856': 'ET', '857': 'ET', '858': 'ET', '859': 'ET',
  '860': 'ET', '862': 'ET', '863': 'ET', '864': 'ET', '865': 'ET', '870': 'ET',
  '872': 'ET', '873': 'ET', '878': 'ET', '901': 'ET', '903': 'ET', '904': 'ET',
  '906': 'ET', '907': 'ET', '908': 'ET', '909': 'ET', '910': 'ET', '912': 'ET',
  '913': 'ET', '914': 'ET', '915': 'ET', '916': 'ET', '917': 'ET', '918': 'ET',
  '919': 'ET', '920': 'ET', '925': 'ET', '927': 'ET', '928': 'ET', '929': 'ET',
  '930': 'ET', '931': 'ET', '934': 'ET', '936': 'ET', '937': 'ET', '938': 'ET',
  '939': 'ET', '940': 'ET', '941': 'ET', '943': 'ET', '945': 'ET', '947': 'ET',
  '948': 'ET', '949': 'ET', '951': 'ET', '952': 'ET', '954': 'ET', '956': 'ET',
  '957': 'ET', '958': 'ET', '959': 'ET', '970': 'ET', '971': 'ET', '972': 'ET',
  '973': 'ET', '978': 'ET', '979': 'ET', '980': 'ET', '984': 'ET', '985': 'ET',
  '986': 'ET', '989': 'ET', '990': 'ET', '991': 'ET', '992': 'ET', '993': 'ET',
  '994': 'ET', '995': 'ET', '996': 'ET', '997': 'ET', '998': 'ET', '999': 'ET',
  
  '206': 'PST', '209': 'PST', '213': 'PST', '253': 'PST', '310': 'PST', '323': 'PST',
  '360': 'PST', '408': 'PST', '415': 'PST', '424': 'PST', '425': 'PST', '442': 'PST',
  '458': 'PST', '464': 'PST', '503': 'PST', '510': 'PST', '530': 'PST', '559': 'PST',
  '562': 'PST', '564': 'PST', '575': 'PST', '602': 'PST', '619': 'PST', '623': 'PST',
  '626': 'PST', '628': 'PST', '629': 'PST', '650': 'PST', '657': 'PST', '661': 'PST',
  '669': 'PST', '702': 'PST', '707': 'PST', '714': 'PST', '720': 'PST', '725': 'PST',
  '747': 'PST', '760': 'PST', '764': 'PST', '805': 'PST', '818': 'PST', '831': 'PST',
  '858': 'PST', '909': 'PST', '916': 'PST', '925': 'PST', '928': 'PST', '949': 'PST',
  '951': 'PST', '952': 'PST', '971': 'PST', '986': 'PST',
  
  '303': 'MT', '307': 'MT', '308': 'MT', '406': 'MT', '435': 'MT', '480': 'MT',
  '505': 'MT', '520': 'MT', '575': 'MT', '602': 'MT', '623': 'MT', '628': 'MT',
  '970': 'MT', '986': 'MT',
  
  '205': 'CT', '214': 'CT', '217': 'CT', '224': 'CT', '225': 'CT', '228': 'CT',
  '229': 'CT', '231': 'CT', '234': 'CT', '239': 'CT', '251': 'CT', '252': 'CT',
  '254': 'CT', '256': 'CT', '260': 'CT', '262': 'CT', '269': 'CT', '270': 'CT',
  '272': 'CT', '274': 'CT', '276': 'CT', '281': 'CT', '283': 'CT', '304': 'CT',
  '308': 'CT', '309': 'CT', '312': 'CT', '313': 'CT', '314': 'CT', '316': 'CT',
  '317': 'CT', '318': 'CT', '319': 'CT', '320': 'CT', '325': 'CT', '330': 'CT',
  '331': 'CT', '332': 'CT', '334': 'CT', '336': 'CT', '337': 'CT', '339': 'CT',
  '341': 'CT', '346': 'CT', '347': 'CT', '351': 'CT', '352': 'CT', '361': 'CT',
  '364': 'CT', '380': 'CT', '385': 'CT', '386': 'CT', '402': 'CT', '405': 'CT',
  '409': 'CT', '410': 'CT', '412': 'CT', '414': 'CT', '417': 'CT', '419': 'CT',
  '423': 'CT', '430': 'CT', '432': 'CT', '434': 'CT', '440': 'CT', '443': 'CT',
  '445': 'CT', '447': 'CT', '448': 'CT', '463': 'CT', '464': 'CT', '469': 'CT',
  '470': 'CT', '475': 'CT', '478': 'CT', '479': 'CT', '484': 'CT', '501': 'CT',
  '502': 'CT', '504': 'CT', '507': 'CT', '508': 'CT', '512': 'CT', '513': 'CT',
  '515': 'CT', '516': 'CT', '517': 'CT', '518': 'CT', '531': 'CT', '534': 'CT',
  '539': 'CT', '540': 'CT', '541': 'CT', '551': 'CT', '557': 'CT', '561': 'CT',
  '563': 'CT', '567': 'CT', '570': 'CT', '571': 'CT', '572': 'CT', '573': 'CT',
  '574': 'CT', '580': 'CT', '585': 'CT', '586': 'CT', '601': 'CT', '606': 'CT',
  '607': 'CT', '608': 'CT', '612': 'CT', '614': 'CT', '615': 'CT', '616': 'CT',
  '618': 'CT', '620': 'CT', '624': 'CT', '625': 'CT', '627': 'CT', '629': 'CT',
  '630': 'CT', '631': 'CT', '636': 'CT', '640': 'CT', '641': 'CT', '646': 'CT',
  '647': 'CT', '649': 'CT', '651': 'CT', '659': 'CT', '660': 'CT', '662': 'CT',
  '667': 'CT', '670': 'CT', '671': 'CT', '672': 'CT', '678': 'CT', '679': 'CT',
  '680': 'CT', '681': 'CT', '682': 'CT', '684': 'CT', '701': 'CT', '704': 'CT',
  '706': 'CT', '708': 'CT', '712': 'CT', '713': 'CT', '715': 'CT', '716': 'CT',
  '717': 'CT', '718': 'CT', '720': 'CT', '724': 'CT', '725': 'CT', '726': 'CT',
  '727': 'CT', '728': 'CT', '729': 'CT', '730': 'CT', '731': 'CT', '732': 'CT',
  '734': 'CT', '737': 'CT', '740': 'CT', '743': 'CT', '754': 'CT', '757': 'CT',
  '758': 'CT', '762': 'CT', '763': 'CT', '765': 'CT', '769': 'CT', '770': 'CT',
  '771': 'CT', '772': 'CT', '773': 'CT', '774': 'CT', '775': 'CT', '779': 'CT',
  '781': 'CT', '784': 'CT', '785': 'CT', '786': 'CT', '787': 'CT', '801': 'CT',
  '802': 'CT', '803': 'CT', '804': 'CT', '806': 'CT', '807': 'CT', '808': 'CT',
  '810': 'CT', '812': 'CT', '813': 'CT', '814': 'CT', '815': 'CT', '816': 'CT',
  '817': 'CT', '819': 'CT', '820': 'CT', '825': 'CT', '828': 'CT', '829': 'CT',
  '830': 'CT', '832': 'CT', '843': 'CT', '845': 'CT', '847': 'CT', '848': 'CT',
  '850': 'CT', '851': 'CT', '856': 'CT', '857': 'CT', '859': 'CT', '860': 'CT',
  '862': 'CT', '863': 'CT', '864': 'CT', '865': 'CT', '870': 'CT', '872': 'CT',
  '873': 'CT', '878': 'CT', '901': 'CT', '903': 'CT', '904': 'CT', '906': 'CT',
  '908': 'CT', '910': 'CT', '912': 'CT', '913': 'CT', '914': 'CT', '915': 'CT',
  '917': 'CT', '918': 'CT', '919': 'CT', '920': 'CT', '927': 'CT', '929': 'CT',
  '930': 'CT', '931': 'CT', '934': 'CT', '936': 'CT', '937': 'CT', '938': 'CT',
  '939': 'CT', '940': 'CT', '941': 'CT', '943': 'CT', '945': 'CT', '947': 'CT',
  '948': 'CT', '951': 'CT', '954': 'CT', '956': 'CT', '957': 'CT', '958': 'CT',
  '959': 'CT', '972': 'CT', '973': 'CT', '978': 'CT', '979': 'CT', '980': 'CT',
  '984': 'CT', '985': 'CT', '989': 'CT', '990': 'CT', '991': 'CT', '992': 'CT',
  '993': 'CT', '994': 'CT', '995': 'CT', '996': 'CT', '997': 'CT', '998': 'CT',
  '999': 'CT'
};

export function detectTimezoneFromPhone(phoneNumber) {
  if (!phoneNumber) {
    return 'ET';
  }
  const normalized = phoneNumber.replace(/[\s\-\(\)]/g, '');
  
  let areaCode = null;
  
  if (normalized.startsWith('+1') && normalized.length >= 12) {
    // Format: +1XXXXXXXXXX
    areaCode = normalized.substring(2, 5);
  } else if (normalized.startsWith('1') && normalized.length >= 11) {
    // Format: 1XXXXXXXXXX
    areaCode = normalized.substring(1, 4);
  } else if (normalized.length >= 10 && /^\d+$/.test(normalized)) {
    // Format: XXXXXXXXXX (10 digits)
    areaCode = normalized.substring(0, 3);
  }
  
  // Check if area code exists in mapping
  if (areaCode && AREA_CODE_TO_TIMEZONE[areaCode]) {
    const timezone = AREA_CODE_TO_TIMEZONE[areaCode];
    console.log(`✅ [PhoneTimezoneDetector] Detected timezone ${timezone} for area code ${areaCode} (phone: ${phoneNumber})`);
    return timezone;
  }
  
  // Default to ET if no match found
  console.log(`⚠️ [PhoneTimezoneDetector] No timezone match for area code ${areaCode || 'unknown'}, defaulting to ET (phone: ${phoneNumber})`);
  return 'ET';
}

export function formatTimeWithTimezone(timeString, timezone) {
  if (!timeString) return timeString;
  const cleanTime = timeString.replace(/\s*(ET|PST|MT|CT|EST|PST|MST|CST)$/i, '').trim();
  
  return `${cleanTime} ${timezone}`;
}

export default {
  detectTimezoneFromPhone,
  formatTimeWithTimezone
};

